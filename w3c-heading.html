<link rel="import" href="bower_components/polymer/polymer.html">
<polymer-element name="w3c-heading">
<template>
<style>
:host {
    display: block;
    font-size: 2em;
    font-weight: bold;
    margin: 0.67em 0;
}

/* FIREFOX styles */
 *:-moz-any(article, aside, nav, section) w3c-heading {
    display: block;
    font-size: 1.5em;
    font-weight: bold;
    margin: 0.83em 0;
}
 *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) w3c-heading {
    display: block;
    font-size: 1.17em;
    font-weight: bold;
    margin: 1em 0;
}
 *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) w3c-heading {
    display: block;
    font-size: 1em;
    font-weight: bold;
    margin: 1.33em 0;
}
 *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) w3c-heading {
    display: block;
    font-size: 0.83em;
    font-weight: bold;
    margin: 1.67em 0;
}

*:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) *:-moz-any(article, aside, nav, section) w3c-heading {
    display: block;
    font-size: 0.67em;
    font-weight: bold;
    margin: 2.33em 0;
}

/* blink/webkit styles */

:-webkit-any(article,aside,nav,section) w3c-heading {
 font-size: 1.5em;
 -webkit-margin-before: 0.83__qem;
-webkit-margin-after: 0.83em;
}

:-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) w3c-heading {
font-size: 1.17em;
-webkit-margin-before: 1__qem;
-webkit-margin-after: 1em;
}

:-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) w3c-heading {
font-size: 1.00em;
-webkit-margin-before: 1.33__qem;
-webkit-margin-after: 1.33em;
}

:-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) w3c-heading {
font-size: .83em;
-webkit-margin-before: 1.67__qem;
-webkit-margin-after: 1.67em;
}

:-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) :-webkit-any(article,aside,nav,section) w3c-heading {
font-size: .67em;
-webkit-margin-before: 2.33__qem;
-webkit-margin-after: 2.33em;
}
</style>
<div><content></content></div>
</template>
<script>
// Thanks to http://stackoverflow.com/a/5178132
function createXPathFromElement(elm) {
    var allNodes = document.getElementsByTagName('*');
    for (var segs = []; elm && elm.nodeType == 1; elm = elm.parentNode)
    {
        if (elm.hasAttribute('id')) {
                var uniqueIdCount = 0;
                for (var n=0;n < allNodes.length;n++) {
                    if (allNodes[n].hasAttribute('id') && allNodes[n].id == elm.id) uniqueIdCount++;
                    if (uniqueIdCount > 1) break;
                };
                if ( uniqueIdCount == 1) {
                    segs.unshift('id("' + elm.getAttribute('id') + '")');
                    return segs.join('/');
                } else {
                    segs.unshift(elm.localName.toLowerCase() + '[@id="' + elm.getAttribute('id') + '"]');
                }
        } else if (elm.hasAttribute('class')) {
            segs.unshift(elm.localName.toLowerCase() + '[@class="' + elm.getAttribute('class') + '"]');
        } else {
            for (i = 1, sib = elm.previousSibling; sib; sib = sib.previousSibling) {
                if (sib.localName == elm.localName)  i++; };
                segs.unshift(elm.localName.toLowerCase() + '[' + i + ']');
        };
    };
    return segs.length ? '/' + segs.join('/') : null;
};

function nestingLevel(element) {
  // TODO currently this works out the XPath of the element and then
  //      counts the nesting level using regex match functions -- YUCK!
  //      Just doing it this way first off to see if it works; if so
  //      we can refactor the XPath-making function to do what we want
  //      much faster!
  var xpath = createXPathFromElement(element);
  var matches = xpath.match(/article|aside|nav|section/g);
  if( matches ) {
    return matches.length + 1;
  } else {
    return 1;
  }
}

Polymer('w3c-heading', {
  ready: function() {
    this.setAttribute('role', 'heading');
    this.setAttribute('aria-level', nestingLevel(this));
  }
});
</script>
</polymer-element>
